window.onload=function(){var V={NAME:"ThoomicDB",VERSION:1},A=["cif","name","telefono","email"],ah=$("#domicilio"),F=$("#cp"),aq=$("#poblacion"),q=$("#pais"),b=[],z=[],I=[],ab=true,M,U=document.getElementById("form_datos"),ag=document.getElementById("currency"),u=$("#panel"),s=$("#deleteID"),r=$("#nuevo_cliente"),Q=$("#popup_delete"),H=$("#address"),N=$("#deltitulo"),am=$("#panel_titulo"),v=$("#lista"),aj=$("#datapanel"),D=$("#nuevobill"),g=$("#btn_save"),J=document.getElementById("jogo"),an=document.getElementById("txjogo"),S=document.getElementById("myFilter"),ar=$("#form_bill"),n=$("#titulobill"),R=$("#numerobill"),C=$("#fechabill"),j=$("#concepto"),af=$("#cantidad"),k=$("#precio"),P=$("#status"),p=$("#msg"),e=$("#rotulo"),ap=$("#principal"),B=document.getElementById("texto_concepto"),L=document.getElementById("texto_new"),ad=$("#titulo_nuevo");function ae(at){if(at){p.text(at);P.animate({opacity:"1"});setTimeout(function(){P.animate({opacity:"0"})},3000);window.console.log(at)}}function f(){var at,au={};for(at in A){if(A.hasOwnProperty(at)){au[A[at]]=localStorage.getItem(A[at])}}au.domicilio=localStorage.getItem("domicilio");au.cp=localStorage.getItem("cp");au.poblacion=localStorage.getItem("poblacion");au.pais=localStorage.getItem("pais");return au}function E(){var at=f();if(!at[1]){e.text("Please, enter your data as an invoice issuer.")}else{e.text("Button menu for details: "+at[1])}}function d(){var av=new Date(),aw,at,au;aw=av.getDate();at=av.getMonth();at=at+1;au=av.getFullYear();av=(aw+"/"+at+"/"+au);return av}function Y(au){var at;if(au){for(at=0;at<au.elements.length;at++){au.elements[at].value="";au.elements[at].style.background="#FFFFFF"}L.innerHTML=""}}function l(at){var au=parseInt(localStorage.getItem(at),10);if(au){au=au+1}else{au=1}localStorage.setItem(at,au);return au}function y(au,at){var av;if(au){u.panel("close");Y(U);ad.text(at);for(av in A){if(A.hasOwnProperty(av)){if(au[A[av]]){U.elements[av].value=au[A[av]]}}}r.popup("open",{positionTo:"window",transition:"pop"})}}function X(){var at;n.text(am.text());at="000000"+l(n.text());R.text(at);C.text(d());j.val("");af.val("");k.val("");B.innerHTML="";D.popup();D.popup("open",{positionTo:"window",transition:"pop"})}function o(){u.panel("close");v.empty();v.removeClass("datos");$("#textologo").empty();$("hori").empty();clearTimeout(M)}function al(at){var av,au=$("#textologo");o();if(at.name){if(am.text()==="Thoomic"){$("<a href='#' class='ui-btn ui-btn-inline ui-icon-grid ui-btn-icon-left ui-mini ui-corner-all color' id='bill'>").append("toBill").appendTo(au);$("#bill").click(function(){t(at.name)})}else{at.domicilio=localStorage.getItem("domicilio");at.cp=localStorage.getItem("cp");at.poblacion=localStorage.getItem("poblacion");at.pais=localStorage.getItem("pais")}$("<a href='#' class='ui-btn ui-btn-inline ui-icon-gear ui-btn-icon-left ui-mini ui-corner-all' id='up'>").append((at.name||"Your company")).appendTo(au);$("<div>").append("<span>&nbsp;&nbsp;&nbsp;"+(at.cif||"")+"</span><span>&nbsp;&nbsp;&nbsp;"+(at.telefono||"")+"</span><span>&nbsp;&nbsp;&nbsp;"+(at.email||"")+"</span><p>").appendTo(au);$("<div class='margen'>").append("<a href='#' id='loc' data-mini='true' class='ui-btn ui-mini ui-icon-home ui-btn-icon-left ui-btn-inline ui-corner-all'>Location</a>").appendTo(au);$("<div>").append("</span><span>&nbsp;&nbsp;&nbsp;"+(at.domicilio||"")).appendTo(au);$("<div>").append("</span><span>&nbsp;&nbsp;&nbsp;"+(at.cp||"")+"</span><span>&nbsp;&nbsp;&nbsp;"+(at.poblacion||"")+"</span><span>&nbsp;&nbsp;&nbsp;"+(at.pais||"")+"</span><p>").appendTo(au);$("#update").text(at.name);$("#up").click(function(){y(at)});$("#loc").click(function(){ah.val(at.domicilio);F.val(at.cp);aq.val(at.poblacion);q.val(at.pais);H.popup("open",{positionTo:"window",transition:"pop"})});$("#logo").show()}else{e.text("Add details of your company.")}}var w=function(au){var av,aw,at;$("#logo").hide();v.addClass("datos");if(typeof au==="string"&&z.length<1){$("#textologo").empty();e.text("Please add new client.");$("<div>").append("<p class='margen' style='color: red;'>There are no clients in the database, please write them.</p>").appendTo("#textologo");$("#logo").show();v.removeClass("datos")}else{if(typeof au!=="string"){$("#currency").val(localStorage.getItem("currency")).change();z.push(au);at=au[A[1]].split(".",1).toString();$("<li>").append("<a href='#' id="+at+"><h3><span>"+au[A[1]]+"</span></h3><p><span>"+au[A[0]]+"</span><span>&nbsp;&nbsp;&nbsp;&nbsp;"+au[A[2]]+"</span><span>&nbsp;&nbsp;&nbsp;&nbsp;"+au[A[3]]+"</span></p></a>").appendTo(v);aw="#"+at;$(aw).click(function(ax){ax.stopPropagation();aj.empty();for(av in au){if(au.hasOwnProperty(av)){if(au[av]){if(av==="cif"){$("<li>").append("<a href='#' class='color ui-mini' id="+av+">"+au[av]+"</a>").appendTo(aj)}else{if(av==="name"){$("<li>").append("<a href='#' class='color ui-mini' id="+av+">"+au[av]+"</a>").appendTo(aj)}else{$("<li class='color ui-mini'>").append("<span>"+au[av]+"</span>").appendTo(aj)}}}}}$("#cif").click(function(ay){t(au[A[1]])});$("#name").click(function(ay){ad.text(au.name);al(au)});$("#clave").text(au.name);aj.listview("refresh");u.panel("open")});v.listview("refresh")}}};function aa(){am.text("Thoomic");s.text("Delete");ad.text("New Client");v.empty();$("#money").show();S.focus();e.text("Customer database, add new clients.");z=[];openDB.odb.open(V,"",w,"read")}function i(){Y(U);if(am.text()==="Thoomic"){aa();ad.text("New Client");e.text("Add customer data.");r.popup("open",{positionTo:"window",transition:"pop"})}else{X()}}function ao(){var at;v.removeClass("datos");clearTimeout(M);Y(U);e.text("Complete your company details.");ad.text("Invoice Issuer");at=f();am.text(at.name);al(at);if(!at.name){r.popup("open",{positionTo:"window",transition:"pop"})}}function m(){u.panel("close");if(z[0]){N.text("Export...")}else{N.text("There is no customer data...")}Q.popup("open",{positionTo:"window",transition:"pop"})}function K(){u.panel("close");Q.popup("open",{positionTo:"window",transition:"pop"})}function ai(ax){var az,at,ay=(localStorage.getItem("tax")||21),au=[],aw=document.getElementById("#form_update"),av=$("#tax");if((typeof ax==="string")&&(I.length<1)){$("#textologo").empty();$("#hori").empty();$("<div>").append("<p class='margen' style='color: red;'>There are no invoices in the database, please write them.</p>").appendTo("#textologo");$("#logo").show();i()}else{v.addClass("datos");$("#money").hide();if(typeof ax!=="string"){$("<li>").append("<a href='#' id="+ax.name+"><h3>"+ax.titulo+"</h3><p>Date: "+ax.fecha+"&nbsp;&nbsp;&nbsp;&nbsp;Bill NÂº: "+ax.name+"&nbsp;&nbsp;&nbsp;&nbsp;</p></a>").appendTo(v);I.push(ax);n.text(ax.titulo);$("#clave").text(ax.name);az="#"+ax.name;$(az).click(function(aB){var aC,aA;aB.stopPropagation();aj.empty();MYPDF.init();openDB.odb.open(V,ax.titulo,MYPDF.client,"get");n.text(ax.titulo);$("#clave").text(ax.name);$("<li>").append("<a href='#' class='color ui-mini' id='name'>No. "+ax.name+"</a>").appendTo(aj);$("<li class='color ui-mini'>").append("<span>"+ax.fecha+"</span>").appendTo(aj);for(aC in ax){if(ax.hasOwnProperty(aC)){if((aC!=="titulo")&&(aC!=="name")&&(aC!=="fecha")&&(aC!=="currency")){$("<li class='color ui-mini'>").append("<span>  "+ax[aC].cantidad+"</span><span class='cantidad'>&nbsp;"+ax[aC].concepto+"</span><span>&nbsp;&nbsp;&nbsp;"+ax[aC].precio+" "+ax.currency+"</span>").appendTo(aj);MYPDF.bill(ax[aC].concepto,ax[aC].cantidad,ax[aC].precio)}}}MYPDF.invoice(ax);$("#btn_generating").click(function(aD){if(av.val()<0){ay=21}else{ay=av.val()}localStorage.setItem("tax",ay);MYPDF.tax(ay);MYPDF.save($("#comments").val(),ax.currency);$("#genpdf").popup("close")});$("#name").click(function(aD){u.panel("close");au=f();av.val(ay);if(au.name){MYPDF.setup(au);$("#comments").val("");$("#genpdf").popup("open",{positionTo:"window",transition:"pop"})}else{ae("Setup is empty, write it!!")}});s.text(ax.name);aj.listview("refresh");u.panel("open")});v.listview("refresh")}}}function t(at){u.panel("close");v.empty();v.removeClass("datos");if(at){e.text("Invoice to: "+at);var au={NAME:at,VERSION:1};openDB.odb.open(au,null,ai,"read");am.text(at);I=[]}$("#logo").hide()}function a(au,at){au.css("background-color","#ffcc66").trigger("create");au.on("focusin",function(){au.css("background-color","#ffffff").trigger("create")});at.innerHTML="Insufficient "+au.attr("placeholder")+"..."}function c(at,av,au){this.concepto=at;this.cantidad=av;this.precio=au}function ac(){var at;if(j.val()){if((af.val())&&(!isNaN(af.val()))&&(af.val()>0)){if((k.val())&&(!isNaN(k.val()))&&(k.val()>0)){at=new c(j.val(),af.val(),k.val());b.push(at);B.innerHTML="<span><b style='font'>"+j.val()+"</b></span>";j.val("");af.val("");k.val("");return true}else{a(k,B);return false}}else{a(af,B);return false}}else{a(j,B);return false}}function T(){var aw,au,at={},av={NAME:n.text(),VERSION:1};at.titulo=n.text();at.name=R.text()+at.titulo.substring(0,1);at.fecha=C.text();at.currency=$("#currency option:selected").text();localStorage.setItem("currency",$("#currency option:selected").val());ae(at.currency);if(ac()){for(aw in b){if(b.hasOwnProperty(aw)){au="concepto"+aw;at[au]=b[aw]}}openDB.odb.open(av,at,ae,"add");D.popup("close");t(at.titulo)}b=[]}function ak(au){var at,av;at=JSON.parse(au);if(at){for(av in at){if(at.hasOwnProperty(av)){openDB.odb.open(V,at[av],ae,"add")}}aa()}}function h(av){var au,at;$("#readfile").popup("close");au=av.target.files[0];if(au){at=new FileReader();at.onload=function(ax){var aw=ax.target.result;ak(aw)};at.readAsText(au);$("#selectfile").val("")}}function x(){var ay,ax={},av=$("#id_cif"),aw=$("#id_nombre"),at=$("#id_telefono"),au=$("#id_email");if(/^(\+\d{2,3}\s)*\d{9,10}$/.test(at.val())){ax.telefono=at.val()}else{a(at,L)}if(aw.val()){ax.name=aw.val()}else{a(aw,L)}if(/^\w+$/.test(av.val())){ax.cif=av.val()}else{a(av,L)}if(/^(([ a-zA-Z0-9_\.\- ])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4}))*$/.test(au.val())){ax.email=au.val()}else{a(au,L);ax.telefono=""}if(ax.name&&ax.cif&&ax.telefono){switch(ad.text()){case"Invoice Issuer":for(ay in ax){if(ax.hasOwnProperty(ay)){localStorage.setItem(ay,ax[ay]);ae(ax[ay])}}al(ax);ae("Data saved from the invoice issuer!!");break;case"New Client":openDB.odb.open(V,ax,ae,"add");aa();break;default:openDB.odb.open(V,ax,ae,"update");aa()}r.popup("close")}}function W(){var at={};at.name=$("#update").text();if(/\w*/.test(ah.val())){at.domicilio=ah.val()}else{a(ah)}if(/\w*/.test(F.val())){at.cp=F.val()}else{a(F)}if(/\w*/.test(aq.val())){at.poblacion=aq.val()}else{a(aq)}if(/\w*/.test(q.val())){at.pais=q.val()}else{a(q)}H.popup("close");if(am.text()==="Thoomic"){openDB.odb.open(V,at,ae,"update");aa()}else{localStorage.setItem("domicilio",at.domicilio);localStorage.setItem("cp",at.cp);localStorage.setItem("poblacion",at.poblacion);localStorage.setItem("pais",at.pais);ao()}}function Z(){var aw,au="ThoomicDB.json",at,ay,av=$("#name"),az={};switch(N.text()){case"Export...":try{at=new Blob([JSON.stringify(z)],{type:"application/json"});saveAs(at,au);ae("ThoomicDB.json file is saved.")}catch(ax){ae("Error: ThoomicDB.json is not saved. "+ax.message)}break;case"Deleting...":if(am.text()==="Thoomic"){aw=av.text();openDB.odb.open(V,aw,ae,"delete");az={NAME:aw,VERSION:1};openDB.odb.open(az,null,ae,"deleteDB");aa()}else{ay=$("#clave").text();aw=am.text();az={NAME:aw,VERSION:1};openDB.odb.open(az,ay,ae,"delete");t(aw)}break;default:}}function O(at){switch(at.keyCode){case 17:ao();break;case 220:ao();break;case 13:aa();break;case 107:i();break;default:}S.value=""}function G(){var aw=$("#reload"),ay=$("#id_nuevo_cliente"),ax=$("#export"),av=$("#menu"),au=$("#btn_popup_delete"),aA=$("#bsave"),at=$("#btn_save_bill"),az=$("#btn_next_bill");aA.click(function(){W()});aw.click(function(){if(M){clearTimeout(M)}aa()});ax.click(function(){e.text("Exports customer database.");m()});ay.click(function(){i()});g.click(function(){x()});s.click(function(){K()});at.click(function(){T()});az.click(function(){ac()});au.click(function(){Z()});av.click(function(){ao()});S.addEventListener("keyup",O,true);document.getElementById("selectfile").addEventListener("change",h,false);document.getElementById("nuevo_cliente").addEventListener("keyup",function(aB){switch(aB.keyCode){case 13:x();break;case 27:r.popup("close");break;default:}});document.getElementById("address").addEventListener("keyup",function(aB){switch(aB.keyCode){case 13:W();break;case 27:H.popup("close");break;default:}})}G();E();M=setTimeout(aa,6000)};